<!DOCTYPE html>
<html>
<head>
    <title>PowerUp Debug Test</title>
    <script src="https://unpkg.com/@microsoft/signalr/dist/browser/signalr.min.js"></script>
    <style>
        body {
            background-color: #1a0b2e;
            color: white;
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #gameCanvas {
            border: 2px solid #4a2c5a;
            background-color: #2a1a3e;
            display: block;
            margin: 0 auto;
        }
        #powerupCanvas {
            border: 2px solid #4a2c5a;
            background-color: #1a0b2e;
            display: block;
            margin: 0 auto;
        }
        .debug {
            background: #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>PowerUp Debug Test</h1>
    <div class="debug">
        <h3>Debug Info:</h3>
        <div id="debugInfo">Starting...</div>
    </div>
    
    <canvas id="gameCanvas" width="600" height="600"></canvas>
    <canvas id="powerupCanvas" width="600" height="60"></canvas>

    <script>
        // Test data
        const testPowerUps = [
            {
                type: 'SpeedBoost',
                position: { x: 5, y: 5 },
                color: '#0080FF',
                isExpired: false,
                remainingExpirationTimePercentage: 0.7
            },
            {
                type: 'Shield',
                position: { x: 10, y: 8 },
                color: '#FFFF00',
                isExpired: false,
                remainingExpirationTimePercentage: 0.4
            }
        ];

        const testActivePowerUpEffects = [
            {
                type: 'DoublePoints',
                color: '#FF00FF',
                remainingEffectTimePercentage: 0.6,
                effectDurationInSeconds: 20
            }
        ];

        // Game constants
        const CELL_SIZE = 20;
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const powerupCanvas = document.getElementById('powerupCanvas');
        const powerupCtx = powerupCanvas.getContext('2d');

        // Utility functions
        function getPowerUpColor(type) {
            switch (type) {
                case 'SpeedBoost': return '#0080FF';   // Blue neon
                case 'Shield': return '#FFFF00';       // Yellow neon
                case 'DoublePoints': return '#FF00FF'; // Pink neon
                case 'Shrink': return '#39FF14';       // Green neon
                default: return '#FFFFFF';
            }
        }

        function getPowerUpIcon(type) {
            switch (type) {
                case 'SpeedBoost': return '‚ö°';
                case 'Shield': return 'üõ°Ô∏è';
                case 'DoublePoints': return '2Ô∏è‚É£';
                case 'Shrink': return 'üåø';
                default: return '?';
            }
        }

        function getEffectName(type) {
            switch (type) {
                case 'SpeedBoost': return 'Speed Boost';
                case 'Shield': return 'Shield';
                case 'DoublePoints': return 'Double Points';
                case 'Shrink': return 'Shrink';
                default: return 'Unknown';
            }
        }

        function drawTestPowerUps() {
            // Clear canvas
            ctx.fillStyle = '#2a1a3e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            document.getElementById('debugInfo').innerHTML = `
                Testing ${testPowerUps.length} powerups<br>
                Canvas size: ${canvas.width}x${canvas.height}<br>
                Cell size: ${CELL_SIZE}
            `;

            // Draw power-ups
            testPowerUps.forEach(powerUp => {
                console.log('Drawing test powerUp:', powerUp);
                
                const centerX = powerUp.position.x * CELL_SIZE + CELL_SIZE / 2;
                const centerY = powerUp.position.y * CELL_SIZE + CELL_SIZE / 2;

                // Draw background circle
                ctx.save();
                ctx.shadowBlur = 15;
                ctx.fillStyle = '#2a1a3e';
                ctx.beginPath();
                ctx.arc(centerX, centerY, CELL_SIZE * 0.45, 0, Math.PI * 2);
                ctx.fill();

                // Draw the power-up icon with glow
                ctx.shadowBlur = 10;
                ctx.shadowColor = powerUp.color;
                ctx.fillStyle = powerUp.color;
                ctx.font = `${CELL_SIZE * 0.6}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                const icon = getPowerUpIcon(powerUp.type);
                ctx.fillText(icon, centerX, centerY);
                
                // Draw expiration progress ring
                if (powerUp.remainingExpirationTimePercentage < 1) {
                    // Draw background ring
                    ctx.shadowBlur = 0;
                    ctx.strokeStyle = '#2a1a3e';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, CELL_SIZE * 0.35, 0, Math.PI * 2);
                    ctx.stroke();

                    // Draw progress ring
                    ctx.strokeStyle = powerUp.color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(
                        centerX, 
                        centerY, 
                        CELL_SIZE * 0.35, 
                        -Math.PI / 2, 
                        -Math.PI / 2 + (Math.PI * 2 * powerUp.remainingExpirationTimePercentage)
                    );
                    ctx.stroke();
                }
                
                ctx.restore();
            });
        }

        function drawTestPowerupPanel() {
            // Clear the powerup panel canvas
            powerupCtx.fillStyle = '#1a0b2e';
            powerupCtx.fillRect(0, 0, powerupCanvas.width, powerupCanvas.height);
            
            if (testActivePowerUpEffects.length > 0) {
                const panelX = 5;
                const panelY = 5;
                const panelWidth = powerupCanvas.width - 10;
                const panelHeight = powerupCanvas.height - 10;
                
                // Draw semi-transparent panel background
                powerupCtx.fillStyle = 'rgba(26, 11, 46, 0.9)';
                powerupCtx.fillRect(panelX, panelY, panelWidth, panelHeight);
                
                // Draw each active effect
                powerupCtx.font = 'bold 16px Arial';
                powerupCtx.textBaseline = 'middle';
                
                const effectWidth = Math.min(280, panelWidth / testActivePowerUpEffects.length);
                
                testActivePowerUpEffects.forEach((effect, index) => {
                    const x = panelX + (effectWidth * index) + 15;
                    const y = panelY + panelHeight / 2;
                    
                    // Draw icon with glow
                    powerupCtx.save();
                    powerupCtx.shadowBlur = 10;
                    powerupCtx.shadowColor = effect.color;
                    powerupCtx.fillStyle = effect.color;
                    powerupCtx.fillText(getPowerUpIcon(effect.type), x, y);
                    
                    // Draw effect name
                    powerupCtx.shadowBlur = 0;
                    powerupCtx.fillStyle = '#ffffff';
                    powerupCtx.textAlign = 'left';
                    powerupCtx.fillText(getEffectName(effect.type), x + 30, y);
                    
                    // Background bar
                    const barWidth = 60;
                    const barHeight = 6;
                    const barX = x + effectWidth - 100;
                    const barY = y - barHeight / 2;
                    
                    powerupCtx.fillStyle = '#2a1a3e';
                    powerupCtx.fillRect(barX, barY, barWidth, barHeight);
                    
                    // Progress bar
                    const remainingPercent = effect.remainingEffectTimePercentage || 0;
                    powerupCtx.fillStyle = effect.color;
                    powerupCtx.fillRect(barX, barY, barWidth * remainingPercent, barHeight);
                    
                    // Draw countdown timer
                    const remainingSeconds = Math.ceil(remainingPercent * effect.effectDurationInSeconds);
                    powerupCtx.fillStyle = '#ffff00';
                    powerupCtx.textAlign = 'left';
                    powerupCtx.fillText(`${remainingSeconds}s`, barX + barWidth + 5, y);
                    
                    powerupCtx.restore();
                });
            }
        }

        // Run test
        drawTestPowerUps();
        drawTestPowerupPanel();

        console.log('Test complete. Check if powerups are visible.');
    </script>
</body>
</html>
