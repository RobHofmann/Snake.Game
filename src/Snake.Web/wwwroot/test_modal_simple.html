<!DOCTYPE html>
<html>
<head>
    <title>Simple Modal Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px;
            background: #0f0f0f;
            color: #4deed4;
        }
        .test-button { 
            padding: 10px 20px; 
            margin: 10px; 
            font-size: 16px; 
            cursor: pointer;
            background: #4deed4;
            color: #0f0f0f;
            border: none;
            border-radius: 5px;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: rgba(76, 238, 212, 0.2); border: 1px solid #4deed4; }
        .error { background: rgba(255, 82, 82, 0.2); border: 1px solid #ff5252; color: #ff5252; }
        .info { background: rgba(77, 182, 172, 0.2); border: 1px solid #4db6ac; color: #4db6ac; }
        .console-output {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #333;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üéØ Simple Modal Test</h1>
    
    <div class="status info" id="status">Ready to test modal functionality</div>
    
    <div>
        <button class="test-button" onclick="loadGame()">üéÆ Load Game</button>
        <button class="test-button" onclick="testModalDirect()">üß™ Test Modal Direct</button>
        <button class="test-button" onclick="simulateGame()">üéØ Simulate Game Score</button>
        <button class="test-button" onclick="checkGameState()">üîç Check Game State</button>
    </div>
    
    <div class="console-output" id="console-output"></div>
    
    <iframe id="game-frame" style="display: none;"></iframe>
    
    <script>
        let gameWindow = null;
        
        function log(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'color: #ff5252' : 
                              type === 'success' ? 'color: #4deed4' : 
                              'color: #ffffff';
            output.innerHTML += `<div style="${colorClass}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
        }
        
        function loadGame() {
            log('üéÆ Loading game...', 'info');
            updateStatus('Loading game...', 'info');
            
            const iframe = document.getElementById('game-frame');
            iframe.style.display = 'block';
            iframe.src = 'http://localhost:5080/';
            
            iframe.onload = function() {
                gameWindow = iframe.contentWindow;
                log('‚úÖ Game loaded successfully', 'success');
                updateStatus('Game loaded! You can now test modal functionality.', 'success');
            };
            
            iframe.onerror = function() {
                log('‚ùå Failed to load game', 'error');
                updateStatus('Failed to load game. Check if server is running.', 'error');
            };
        }
        
        function testModalDirect() {
            if (!gameWindow) {
                log('‚ùå Game not loaded yet', 'error');
                updateStatus('Load game first!', 'error');
                return;
            }
            
            try {
                log('üß™ Testing modal function directly...', 'info');
                
                // Set up test conditions
                gameWindow.score = 100;
                gameWindow.gameWasPlayed = true;
                gameWindow.gameStartTime = Date.now() - 10000;
                gameWindow.scoreSubmitted = false;
                gameWindow.pageLoadTime = Date.now() - 30000;
                
                log(`‚úÖ Test conditions set: score=${gameWindow.score}`, 'success');
                
                // Call showNameInputModal directly
                if (typeof gameWindow.showNameInputModal === 'function') {
                    log('üöÄ Calling showNameInputModal()...', 'info');
                    gameWindow.showNameInputModal();
                    
                    // Check if modal appeared
                    setTimeout(() => {
                        const modal = gameWindow.document.getElementById('nameInputModal');
                        const isVisible = modal && !modal.classList.contains('hide');
                        
                        if (isVisible) {
                            log('‚úÖ SUCCESS! Modal is visible!', 'success');
                            updateStatus('Modal test PASSED - modal is visible', 'success');
                        } else {
                            log('‚ùå FAILED! Modal is not visible', 'error');
                            log(`Modal element: ${modal ? 'exists' : 'missing'}`, 'error');
                            if (modal) {
                                log(`Modal classes: ${modal.className}`, 'error');
                            }
                            updateStatus('Modal test FAILED - modal not visible', 'error');
                        }
                    }, 500);
                } else {
                    log('‚ùå showNameInputModal function not found', 'error');
                    updateStatus('showNameInputModal function not found!', 'error');
                }
                
            } catch (error) {
                log(`‚ùå Error testing modal: ${error.message}`, 'error');
                updateStatus(`Error: ${error.message}`, 'error');
            }
        }
        
        function simulateGame() {
            if (!gameWindow) {
                log('‚ùå Game not loaded yet', 'error');
                updateStatus('Load game first!', 'error');
                return;
            }
            
            try {
                log('üéØ Simulating complete game...', 'info');
                
                // Set up complete game scenario
                gameWindow.score = 150;
                gameWindow.gameState = 'GameOver';
                gameWindow.gameWasPlayed = true;
                gameWindow.gameStartTime = Date.now() - 15000;
                gameWindow.scoreSubmitted = false;
                gameWindow.pageLoadTime = Date.now() - 60000;
                
                log(`‚úÖ Game scenario set: score=${gameWindow.score}, gameState=${gameWindow.gameState}`, 'success');
                
                // Call updateUI to trigger normal flow
                if (typeof gameWindow.updateUI === 'function') {
                    log('üîÑ Calling updateUI()...', 'info');
                    gameWindow.updateUI();
                    
                    // Check result
                    setTimeout(() => {
                        const modal = gameWindow.document.getElementById('nameInputModal');
                        const isVisible = modal && !modal.classList.contains('hide');
                        
                        if (isVisible) {
                            log('‚úÖ SUCCESS! Modal triggered through game flow!', 'success');
                            updateStatus('Game simulation PASSED - modal appeared', 'success');
                        } else {
                            log('‚ùå FAILED! Modal not triggered through game flow', 'error');
                            updateStatus('Game simulation FAILED - modal did not appear', 'error');
                        }
                    }, 1000);
                } else {
                    log('‚ùå updateUI function not found', 'error');
                    updateStatus('updateUI function not found!', 'error');
                }
                
            } catch (error) {
                log(`‚ùå Error simulating game: ${error.message}`, 'error');
                updateStatus(`Error: ${error.message}`, 'error');
            }
        }
        
        function checkGameState() {
            if (!gameWindow) {
                log('‚ùå Game not loaded yet', 'error');
                updateStatus('Load game first!', 'error');
                return;
            }
            
            try {
                log('üîç Checking current game state...', 'info');
                
                const state = {
                    gameState: gameWindow.gameState,
                    score: gameWindow.score,
                    gameStartTime: gameWindow.gameStartTime,
                    gameWasPlayed: gameWindow.gameWasPlayed,
                    scoreSubmitted: gameWindow.scoreSubmitted,
                    pageLoadTime: gameWindow.pageLoadTime
                };
                
                log('üìä Current game state:', 'info');
                Object.entries(state).forEach(([key, value]) => {
                    log(`   ${key}: ${value}`, 'info');
                });
                
                // Check time calculations
                if (gameWindow.pageLoadTime > 0) {
                    const timeSincePageLoad = Date.now() - gameWindow.pageLoadTime;
                    log(`   timeSincePageLoad: ${timeSincePageLoad}ms`, 'info');
                }
                
                if (gameWindow.gameStartTime > 0) {
                    const timeSinceGameStart = Date.now() - gameWindow.gameStartTime;
                    log(`   timeSinceGameStart: ${timeSinceGameStart}ms`, 'info');
                }
                
                // Check updateUI condition
                const condition = !gameWindow.scoreSubmitted && 
                                 gameWindow.gameStartTime > 0 && 
                                 gameWindow.score > 0 && 
                                 gameWindow.gameWasPlayed;
                
                log(`üéØ updateUI modal condition: ${condition}`, condition ? 'success' : 'error');
                
                updateStatus('Game state checked - see console output', 'info');
                
            } catch (error) {
                log(`‚ùå Error checking game state: ${error.message}`, 'error');
                updateStatus(`Error: ${error.message}`, 'error');
            }
        }
        
        // Initial message
        log('üéØ Simple Modal Test Ready', 'success');
        log('Click "Load Game" to begin testing...', 'info');
    </script>
</body>
</html>
