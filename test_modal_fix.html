<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .pass { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .pending { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        iframe { width: 100%; height: 500px; border: 1px solid #ccc; margin: 20px 0; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Snake Game Modal Fix Test</h1>
    
    <div class="test-result pending" id="test-status">
        <strong>Test Status:</strong> Loading game in iframe...
    </div>
    
    <div>
        <button onclick="startTest()">Run Test</button>
        <button onclick="reloadGame()">Reload Game</button>
    </div>
    
    <iframe id="game-frame" src="http://localhost:5080"></iframe>
    
    <div id="test-log">
        <h3>Test Log:</h3>
        <div id="log-content"></div>
    </div>

    <script>
        let testStartTime = Date.now();
        let modalCheckTimeout;
        
        function log(message) {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            logContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        }
        
        function updateTestStatus(status, message, isPass) {
            const statusDiv = document.getElementById('test-status');
            statusDiv.className = `test-result ${status}`;
            statusDiv.innerHTML = `<strong>Test Status:</strong> ${message}`;
        }
        
        function startTest() {
            log('Starting modal fix test...');
            updateTestStatus('pending', 'Testing if modal appears on page load...');
            
            // Clear any existing timeout
            if (modalCheckTimeout) {
                clearTimeout(modalCheckTimeout);
            }
            
            // Check after 3 seconds if modal appears inappropriately
            modalCheckTimeout = setTimeout(() => {
                try {
                    const iframe = document.getElementById('game-frame');
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const modal = iframeDoc.getElementById('nameInputModal');
                    
                    if (modal && !modal.classList.contains('hide')) {
                        log('❌ FAIL: Modal is visible on page load');
                        updateTestStatus('fail', 'Modal incorrectly appears on page load');
                    } else {
                        log('✅ PASS: Modal is hidden on page load');
                        updateTestStatus('pass', 'Modal correctly hidden on page load');
                    }
                } catch (error) {
                    log(`❌ ERROR: Cannot access iframe content - ${error.message}`);
                    updateTestStatus('fail', 'Cannot access iframe content (likely CORS issue)');
                }
            }, 3000);
            
            log('Test will complete in 3 seconds...');
        }
        
        function reloadGame() {
            log('Reloading game iframe...');
            document.getElementById('game-frame').src = 'http://localhost:5080?' + Date.now();
            updateTestStatus('pending', 'Game reloaded, waiting for new test...');
        }
        
        // Auto-start test when page loads
        window.onload = function() {
            log('Test page loaded');
            setTimeout(startTest, 1000); // Start test after 1 second
        };
    </script>
</body>
</html>
