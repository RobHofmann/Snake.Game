<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syntax Fixes Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #1a1a1a;
            color: #00ff00;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid;
        }
        .success { background-color: #2a4a2a; border-color: #4f4; color: #4f4; }
        .error { background-color: #4a2a2a; border-color: #f44; color: #f44; }
        .info { background-color: #2a2a4a; border-color: #44f; color: #44f; }
        button {
            background-color: #333;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background-color: #0f0; color: #000; }
        #gameFrame {
            width: 100%;
            height: 600px;
            border: 1px solid #0f0;
            margin: 20px 0;
        }
        .log {
            background-color: #222;
            border: 1px solid #333;
            padding: 10px;
            margin: 10px 0;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üêç Snake Game - Syntax Fixes Test</h1>
        
        <div class="status info">
            <div id="status">Ready to test syntax fixes</div>
        </div>
        
        <div>
            <button onclick="loadGame()">üéÆ Load Game</button>
            <button onclick="testConsoleAccess()">üîç Test Console Access</button>
            <button onclick="simulateConsecutiveGames()">üîÑ Test Consecutive Games</button>
            <button onclick="clearLog()">üßπ Clear Log</button>
        </div>
        
        <iframe id="gameFrame" src="about:blank"></iframe>
        
        <div class="log" id="log"></div>
    </div>

    <script>
        let gameWindow = null;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : 
                             type === 'error' ? 'error' : 'info';
            
            logDiv.innerHTML += `<div style="color: ${
                type === 'success' ? '#4f4' : 
                type === 'error' ? '#f44' : '#44f'
            }">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.parentElement.className = `status ${type}`;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function loadGame() {
            log('üöÄ Loading game to test syntax fixes...', 'info');
            updateStatus('Loading game...', 'info');
            
            const frame = document.getElementById('gameFrame');
            frame.src = 'https://localhost:7001';
            
            frame.onload = function() {
                gameWindow = this.contentWindow;
                log('‚úÖ Game loaded successfully', 'success');
                updateStatus('Game loaded! Test buttons are now active.', 'success');
            };
            
            frame.onerror = function() {
                log('‚ùå Failed to load game', 'error');
                updateStatus('Failed to load game', 'error');
            };
        }
        
        function testConsoleAccess() {
            if (!gameWindow) {
                log('‚ùå Game not loaded yet', 'error');
                updateStatus('Load game first!', 'error');
                return;
            }
            
            try {
                log('üîç Testing console access and syntax...', 'info');
                
                // Test if basic functions exist without syntax errors
                const functions = [
                    'updateUI',
                    'checkForHighScore',
                    'showNameInputModal',
                    'submitScore'
                ];
                
                functions.forEach(funcName => {
                    if (typeof gameWindow[funcName] === 'function') {
                        log(`‚úÖ ${funcName} function exists`, 'success');
                    } else {
                        log(`‚ùå ${funcName} function missing`, 'error');
                    }
                });
                
                // Test basic variable access
                const variables = [
                    'gameState',
                    'score',
                    'gameStartTime',
                    'gameWasPlayed',
                    'scoreSubmitted'
                ];
                
                variables.forEach(varName => {
                    try {
                        const value = gameWindow[varName];
                        log(`‚úÖ ${varName}: ${value}`, 'success');
                    } catch (error) {
                        log(`‚ùå Error accessing ${varName}: ${error.message}`, 'error');
                    }
                });
                
                updateStatus('Console access test completed - check log', 'success');
                
            } catch (error) {
                log(`‚ùå Console access test failed: ${error.message}`, 'error');
                updateStatus('Console access test failed', 'error');
            }
        }
        
        function simulateConsecutiveGames() {
            if (!gameWindow) {
                log('‚ùå Game not loaded yet', 'error');
                updateStatus('Load game first!', 'error');
                return;
            }
            
            try {
                log('üîÑ TESTING CONSECUTIVE GAMES FOR MODAL ISSUE...', 'info');
                updateStatus('Testing consecutive games...', 'info');
                
                let gameCount = 0;
                let successCount = 0;
                
                function runGameCycle(cycleNum, callback) {
                    try {
                        log(`\nüéØ GAME CYCLE ${cycleNum}:`, 'info');
                        
                        // Step 1: Reset to Ready state
                        gameWindow.gameState = 'Ready';
                        gameWindow.updateUI();
                        log(`1Ô∏è‚É£ Reset to Ready state`, 'info');
                        
                        // Step 2: Start game
                        gameWindow.gameState = 'Playing';
                        gameWindow.gameStartTime = Date.now() - (5000 + cycleNum * 1000);
                        gameWindow.gameWasPlayed = true;
                        gameWindow.scoreSubmitted = false;
                        gameWindow.score = 100 + (cycleNum * 50);
                        gameWindow.pageLoadTime = Date.now() - 60000; // Well past grace period
                        log(`2Ô∏è‚É£ Started game ${cycleNum} with score ${gameWindow.score}`, 'info');
                        
                        // Step 3: End game
                        gameWindow.gameState = 'GameOver';
                        gameWindow.updateUI();
                        log(`3Ô∏è‚É£ Game ${cycleNum} ended, updateUI() called`, 'info');
                        
                        // Step 4: Check if modal appeared
                        setTimeout(() => {
                            const modal = gameWindow.document.getElementById('nameInputModal');
                            const isVisible = modal && !modal.classList.contains('hide');
                            
                            log(`üìä CYCLE ${cycleNum} RESULT: Modal visible = ${isVisible}`, 
                                isVisible ? 'success' : 'error');
                            
                            if (isVisible) {
                                successCount++;
                                // Simulate submitting score to reset for next cycle
                                gameWindow.submitScore(`TestPlayer${cycleNum}`);
                                log(`‚úÖ Score submitted for cycle ${cycleNum}`, 'success');
                            }
                            
                            gameCount++;
                            
                            if (callback) callback();
                        }, 500);
                        
                    } catch (error) {
                        log(`‚ùå Error in cycle ${cycleNum}: ${error.message}`, 'error');
                        gameCount++;
                        if (callback) callback();
                    }
                }
                
                // Run 3 consecutive game cycles
                runGameCycle(1, () => {
                    setTimeout(() => {
                        runGameCycle(2, () => {
                            setTimeout(() => {
                                runGameCycle(3, () => {
                                    // Show final results
                                    setTimeout(() => {
                                        log(`\nüìä CONSECUTIVE MODAL TEST RESULTS:`, 'info');
                                        log(`Games tested: ${gameCount}`, 'info');
                                        log(`Modals appeared: ${successCount}`, 'info');
                                        log(`Success rate: ${Math.round((successCount / gameCount) * 100)}%`, 
                                            successCount === gameCount ? 'success' : 'error');
                                        
                                        if (successCount === gameCount) {
                                            updateStatus(`‚úÖ Consecutive modal test PASSED! ${successCount}/${gameCount} modals appeared.`, 'success');
                                        } else {
                                            updateStatus(`‚ùå Consecutive modal test FAILED. Only ${successCount}/${gameCount} modals appeared.`, 'error');
                                        }
                                    }, 1000);
                                });
                            }, 2000);
                        });
                    }, 2000);
                });
                
            } catch (error) {
                log(`‚ùå Consecutive games test failed: ${error.message}`, 'error');
                updateStatus('Consecutive games test failed', 'error');
            }
        }
        
        // Initial log message
        log('üîß Syntax Fixes Test Ready', 'success');
        log('Click "Load Game" to begin testing...', 'info');
    </script>
</body>
</html>
